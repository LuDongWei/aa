/*! seckill 1.0.0 pub 2014-06-16 14:53 by douban */
define("mbb/seckill/1.0.0/seckilling",["jquery","gallery/handlebars/1.0.0/handlebars","./template/seckill.handlebars"],function(a,b){function c(){g(u,v,p.beginTime,p.endTime).done(function(a){if(0!==s.length)for(var b=0;b<s.length;b++){var c=(s[b].activity+"").split(",");1===c.length?d(c[0],s[b],a.activityID,"act"):e(c,s[b],a.activityID,"act")}if(0!==t.length)for(var f=0;f<t.length;f++){var g=(t[f].sale+"").split(",");1===g.length?d(g[0],t[f],a.salesList,"ap"):e(g,t[f],a.salesList,"ap")}s=[],t=[],u="",v=""})}function d(a,b,c,d){var e=null;if("act"==d&&void 0!==c[a]&&(e=h(b,c[a])),"ap"==d)for(var g=0;g<c.length;g++)c[g].apId==a&&(e=h(b,[c[g]]));null===e&&(e=h(b,w)),f(b,e)}function e(a,b,c,d){var e=null,g=[];if("act"==d)for(var i=0;i<a.length;i++)e=void 0===c[a[i]]?h(b,w):h(b,c[a[i]]),g.push(e);if("ap"==d)for(var j=0;j<a.length;j++){for(var k=0;k<c.length;k++)c[k].apId==a[j]&&(e=h(b,[c[k]]));null===e&&(e=h(b,w)),g.push(e),e=null}f(b,g)}function f(a,b){b=p.amendDate(b);var c="";if(null===a.template)c=m({seckill:b});else if("object"==typeof a.template){var d=l.compile(a.template.html());c=d({seckill:b})}else"function"==typeof a.template&&(c=a.template({seckill:b}));"html"==a.showType?a.divID.html(c):"append"==a.showType&&a.divID.append(c),a.returnData(b)}function g(a,b,c,d){return k.ajax({url:q,type:"get",dataType:"jsonp",jsonp:"jsoncallback",data:{act_id:a,ap_id:b,begin_time:c,end_time:d}})}function h(a,b){var c={};c="0"!=a.showDay?void 0===b[a.showDay]?w[0]:b[a.showDay]:b[0],c.isOverdue=c.isSeckill?!1:c.passLag<0?!0:!1,null!==a.countDown&&(c.isSeckill?i(a,c.remainLag,"remainTitle",c.apId):c.isOverdue?a.countDown("\u8fc7\u671f\u4e86\uff01"):i(a,c.passLag,"passtitle",c.apId));for(var d=0;d<c.skus.length;d++){if(c.skus[d].isSellOut=c.skus[d].stock>0?!1:!0,"100"!=a.imgSize){var e=c.skus[d].image;c.skus[d].image=e.replace("/100/","/"+a.imgSize+"/")}var f=c.skus[d].sellPrice,g=c.skus[d].shoppePrice,h=1,j=f?String(f/g*10,10).substring(0,3):String(f/g*10).substring(0,h+2);c.skus[d].discount=j+"\u6298"}return c.divID=a.divID,c}function i(a,b,c,d){var e=a.countDown,f=a[c],g=null;if("remainTitle"===c&&(g=a.end),"passtitle"===c&&(g=a.begin),0>=b)g(d);else var h=setInterval(function(){var a=j(b);b-=1,e(a,f,d),0===a.d&&0===a.h&&0===a.m&&0===a.s&&(g(d),clearTimeout(h))},1e3)}function j(a){var b=parseInt(a/3600/24,10),c=parseInt(a/3600%24,10),d=parseInt(a/60%60,10),e=parseInt(a%60,10),f=(10>b?"0":"")+b,g=(10>c?"0":"")+c,h=(10>d?"0":"")+d,i=(10>e?"0":"")+e,j={d:b,h:c,m:d,s:e,dd:f,hh:g,mm:h,ss:i};return j}var k=a("jquery"),l=a("gallery/handlebars/1.0.0/handlebars"),m=a("./template/seckill.handlebars"),n=b,o={activity:"",sale:"",divID:"",showDay:0,imgSize:"100",template:null,passtitle:"\u8ddd\u79bb\u79d2\u6740\u5f00\u59cb",remainTitle:"\u8ddd\u79bb\u79d2\u6740\u7ed3\u675f",countDown:null,showType:"html",returnData:function(){},begin:function(){},end:function(){}},p={beginTime:"",endTime:"",amendDate:function(a){return a}},q="http://www.mbaobao.com/seckill/saleapi",r=[],s=[],t=[],u="",v="",w=[{stockQty:0,beginTime:"2014/5/29 9:30:38",endTime:"2014/5/29 14:00:51",passLag:"10",remainLag:"10",isSeckill:!1,apId:"0000",sort:1,remark:"",skus:[{sku:404,shoppePrice:"???",mbbPrice:"???",sellPrice:"???",priceTitle:"???",brandName:"???",categoryName:"???",promTitle:"",name:"???",image:"http://cca.mbaobao.com/mkts/201406/05/100/01.gif",stock:0}]}];n.create=function(a){var b=k.extend({},o,a||{});"object"!=typeof b.divID&&(b.divID=k("#"+b.divID)),r.push(b)},n.start=function(a){for(var b=(k.extend(p,a||{}),0);b<r.length;b++)""!==r[b].activity&&(s.push(r[b]),u=u+","+r[b].activity),""!==r[b].sale&&(t.push(r[b]),v=v+","+r[b].sale);c()}}),define("mbb/seckill/1.0.0/template/seckill.handlebars",["gallery/handlebars/1.0.0/handlebars"],function(a,b,c){var d=a("gallery/handlebars/1.0.0/handlebars"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+="\r\n       <li data-apId=",(d=c.apId)?d=d.call(a,{hash:{},data:b}):(d=a.apId,d=typeof d===v?d.apply(a):d),f+=w(d)+' >\r\n          <div class="seckill-item">\r\n             <div class="s-time">\r\n             </div>\r\n             ',e={hash:{},inverse:x.noop,fn:x.program(2,g,b),data:b},(d=c.skus)?d=d.call(a,e):(d=a.skus,d=typeof d===v?d.apply(a):d),c.skus||(d=y.call(a,d,e)),(d||0===d)&&(f+=d),f+=" \r\n            ",d=c["if"].call(a,a.isSeckill,{hash:{},inverse:x.program(7,j,b),fn:x.program(5,i,b),data:b}),(d||0===d)&&(f+=d),f+="      \r\n            ",d=c["if"].call(a,a.isOverdue,{hash:{},inverse:x.noop,fn:x.program(9,k,b),data:b}),(d||0===d)&&(f+=d),f+="\r\n             \r\n            ",d=c["if"].call(a,a.isSeckill,{hash:{},inverse:x.program(17,p,b),fn:x.program(11,l,b),data:b}),(d||0===d)&&(f+=d),f+=" \r\n          </div>\r\n        </li> \r\n     "}function g(a,b){var d,e="";return e+='      \r\n             <div class="s-pic">\r\n                   <span>\u8fd8\u5269',(d=c.stock)?d=d.call(a,{hash:{},data:b}):(d=a.stock,d=typeof d===v?d.apply(a):d),e+=w(d)+'</span>\r\n                   <a href="http://www.mbaobao.com/item/',(d=c.sku)?d=d.call(a,{hash:{},data:b}):(d=a.sku,d=typeof d===v?d.apply(a):d),e+=w(d)+'" target="_blank"><img src=',(d=c.image)?d=d.call(a,{hash:{},data:b}):(d=a.image,d=typeof d===v?d.apply(a):d),e+=w(d)+" alt=",(d=c.name)?d=d.call(a,{hash:{},data:b}):(d=a.name,d=typeof d===v?d.apply(a):d),e+=w(d)+' /></a>\r\n             </div>\r\n             <div class="s-content">\r\n                <div class="s-inf">\r\n                    <p class="shoppeP"><del>\u5e02\u573a\u4ef7\uffe5',(d=c.shoppePrice)?d=d.call(a,{hash:{},data:b}):(d=a.shoppePrice,d=typeof d===v?d.apply(a):d),e+=w(d)+'</del></p>\r\n                    <p class="sellP">\u79d2\u6740\u4ef7<span>\uffe5</span><span>',(d=c.sellPrice)?d=d.call(a,{hash:{},data:b}):(d=a.sellPrice,d=typeof d===v?d.apply(a):d),e+=w(d)+'</span></p> \r\n                </div>\r\n                <div class="s-buy">\r\n                    <span class="s-but">\r\n                        <i></i> \r\n                        <a href="http://cart.mbaobao.com/do/items/add/',(d=c.sku)?d=d.call(a,{hash:{},data:b}):(d=a.sku,d=typeof d===v?d.apply(a):d),e+=w(d)+'/1.html" target="_blank">\u79d2</a>\r\n                    </span> \r\n                </div>           \r\n            </div>\r\n                ',d=c["if"].call(a,a.isSellOut,{hash:{},inverse:x.noop,fn:x.program(3,h,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n            "}function h(){return'\r\n                  <div class="no-stockQty">\r\n                       \u5df2\u7ecf\u62a2\u8d2d\u5b8c\r\n                  </div>\r\n                '}function i(){return'    \r\n                <div class="have-begin">\r\n                     \u79d2\u6740\u5f00\u59cb\r\n                </div>\r\n                '}function j(){return'\r\n                <div class="no-begin">\r\n                     \u672a\u5f00\u59cb \r\n                </div>\r\n            '}function k(){return'\r\n                <div class="no-stockQty">\r\n                     \u5df2\u7ecf\u8fc7\u671f\r\n                </div>\r\n            '}function l(a,b){var d,e,f="";return f+="\r\n                   ",e={hash:{},inverse:x.noop,fn:x.program(12,m,b),data:b},(d=c.skus)?d=d.call(a,e):(d=a.skus,d=typeof d===v?d.apply(a):d),c.skus||(d=y.call(a,d,e)),(d||0===d)&&(f+=d),f+="    \r\n               "}function m(a,b){var d,e="";return e+="\r\n                   ",d=c["if"].call(a,a.isSellOut,{hash:{},inverse:x.program(15,o,b),fn:x.program(13,n,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n                   "}function n(){return"\r\n                     "}function o(){return"\r\n                   "}function p(a,b){var d,e="";return e+="\r\n                   ",d=c["if"].call(a,a.isOverdue,{hash:{},inverse:x.program(15,o,b),fn:x.program(18,q,b),data:b}),(d||0===d)&&(e+=d),e+="  \r\n            "}function q(){return" \r\n                     "}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var r in a.helpers)c[r]=c[r]||a.helpers[r];e=e||{};var s,t,u="",v="function",w=this.escapeExpression,x=this,y=c.blockHelperMissing;return u+='<ul class="mbbSeckill">\r\n     ',t={hash:{},inverse:x.noop,fn:x.program(1,f,e),data:e},(s=c.seckill)?s=s.call(b,t):(s=b.seckill,s=typeof s===v?s.apply(b):s),c.seckill||(s=y.call(b,s,t)),(s||0===s)&&(u+=s),u+="\r\n </ul>"})});
